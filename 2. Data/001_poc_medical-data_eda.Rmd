---
title: "R Notebook"
output: html_notebook
---



deicde on flex v shiny dashboard -- shny would be best but more $$$$?


```{r load data}

# load data
library(medicaldata)

library(tidyverse)
library("kableExtra")

# this one looks good!
indo_rct <- medicaldata::indo_rct

```

# codebook
https://htmlpreview.github.io/?https://github.com/higgi13425/medicaldata/blob/master/man/codebooks/indo_rct_codebook.html

```{r}
# codebook
# https://htmlpreview.github.io/?https://github.com/higgi13425/medicaldata/blob/master/man/codebooks/indo_rct_codebook.html


#article related
#https://www.nejm.org/doi/full/10.1056/NEJMoa1111103



```


```{r}

head(indo_rct)

```



```{r}

# treatment group
indo_rct %>% group_by(rx) %>% count()

```




```{r age}


indo_rct %>% group_by(rx) %>% summarise(age_mean = round(mean(age),1),
                                        sd = round(sd(age),1))

```

```{r}


indo_rct %>% group_by(rx,gender) %>% count() %>% group_by(rx) %>%
             mutate(percent = round(n/sum(n),2)) 

```




```{r}

head(indo_rct)

```




```{r variables for table 1}
# sod - sphincter of oddi dysfunction was present, a risk factor favoring post-ERCP pancreatitis
# pep - previous post-ERCP pancreatitis (PEP), a risk factor for future PEP
# recpaesnc - Recurrent Pancreatitis, a risk factor for future PEP
# precut - a sphincter pre-cut was needed to enter the papilla, a risk factor for PEP
# difcan - Cannulation of the papilla was difficult, a risk factor for PEP
# amp - An Ampullectomy was performed for dysplasia or cancer, which could be a risk factor for PEP
# paninj - Contrast was injected into the pancreas during the procedure, a risk factor for PEP
# acinar - The pancreas appeared to have acinarization on imaging, which could be a risk factor for PEP
# prophystent - A pancreatic duct stent was placed at the end of the procedure per the judgement of the endoscopist (more often in high-risk cases), a potential protective effect against PEP
# bsphinct - A biliary sphincterotomy was performed, which could be a risk factor for PEP
#----bsphinc not bsinct

# train - A trainee participated in the ERCP, which could be a risk factor for PEP


# type - Sphincter of Oddi dysfunction type/level - higher numbers are more severe with greater association with PEP
indo_rct_long <- indo_rct %>% dplyr::select(id, site,rx, age, sod, pep,recpanc,precut,
                                            difcan,amp,train,prophystent,acinar,paninj,bsphinc) %>%
                 pivot_longer(cols = -c(id,site,rx,age),
                              names_to = "category", 
                              values_to = "value",
                              values_transform = list(value = as.character))
     

head(indo_rct_long)   
```









```{r table 1}

# thisi s the code for creating table 1, make into a nice kable?
# recreating table 1
table1 <- indo_rct_long %>% group_by(rx,category,value) %>% count() %>%
                  group_by(rx,category) %>%
                  # calculate percentages
                  mutate(percent =  round((n/sum(n))*100,1),
                         #total = sum(n),
                         #n_n = paste0(n,"/",total)
                         ) %>%
                  # only care about positives
                  filter(value == "1_yes") %>%
                  # remove uselss variables
                  dplyr::select(-value) %>%
                  # pivot wider by treatment group
                  pivot_wider(., names_from = rx, values_from = n:percent) %>%
                  dplyr::select(category,
                                percent_0_placebo ,n_0_placebo,
                                percent_1_indomethacin,n_1_indomethacin)



table1

#indo_rct_long %>% group_by(value) %>% count()

```



```{r table 1 kable}




knitr::kable(table1,"html", table.attr = "style='width:80%;'",row.names = F,
      col.names = c("Characteristics","%","n","%","n"),
      align = c("l",rep("c",4))) %>%
      kable_styling(full_width = F,bootstrap_options = c("striped", "hover"), font_size = 10) %>%
      add_header_above(c(" " = 1, "Placebo" = 2, "Indomethacin" = 2))


```


































